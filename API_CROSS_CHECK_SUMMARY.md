# API Cross-Check Summary

## âœ… Authentication APIs - All Verified

### 1.1 Register User âœ…
- **Endpoint**: `POST /auth/register`
- **Content-Type**: `multipart/form-data` âœ…
- **Fields**: username, email, password, confirm_password, profile_image âœ…
- **Implementation**: `AuthRepository.register()` âœ…

### 1.2 Verify Email OTP âœ…
- **Endpoint**: `POST /auth/verify`
- **Body**: `{ "code": 123456 }` âœ… (Updated - removed email requirement)
- **Implementation**: `AuthRepository.verifyEmail()` âœ…

### 1.3 Resend Verification Code âœ…
- **Endpoint**: `POST /auth/resend-code`
- **Implementation**: `AuthRepository.resendCode()` âœ…
- **View Model**: `VerificationViewModel.resendCode()` âœ…

### 1.4 Login âœ…
- **Endpoint**: `POST /auth/login`
- **Body**: `{ "email": "...", "password": "..." }` âœ…
- **Response**: `access_token`, `refresh_token`, `token_type` âœ…
- **Implementation**: `AuthRepository.login()` âœ…

### 1.5 Refresh Access Token âœ…
- **Endpoint**: `POST /auth/refresh?refresh_token=<token>` âœ…
- **Implementation**: `AuthRepository.refreshToken()` âœ…

### 1.6 Forgot Password âœ…
- **Endpoint**: `POST /auth/forgot-password`
- **Body**: `{ "email": "..." }` âœ…
- **Implementation**: `AuthRepository.forgotPassword()` âœ…
- **View Model**: `ForgotPasswordViewModel` âœ…

### 1.7 Verify Forgot Password OTP âœ…
- **Endpoint**: `POST /auth/verify-forgot-otp`
- **Body**: `{ "code": 123456 }` âœ…
- **Implementation**: `AuthRepository.verifyForgotOtp()` âœ…
- **View Model**: `ForgorVerificationViewModel` âœ…

### 1.8 Set New Password âœ…
- **Endpoint**: `POST /auth/set-new-password`
- **Body**: `{ "password": "...", "confirm_password": "..." }` âœ…
- **Implementation**: `AuthRepository.setNewPassword()` âœ…
- **View Model**: `SetNewPasswordViewModel` âœ…
- **Screen**: `SetNewPasswordScreen` âœ…

### 1.9 Reset Password (Logged-in) âœ…
- **Endpoint**: `POST /auth/reset-password`
- **Requires**: Authorization âœ…
- **Body**: `{ "old_password": "...", "password": "...", "confirm_password": "..." }` âœ…
- **Implementation**: `AuthRepository.resetPassword()` âœ…

### 1.10 Google Sign-In âœ…
- **Endpoint**: `POST /auth/google`
- **Body**: `{ "id_token": "...", "name": "...", "picture": "..." }` âœ…
- **Implementation**: `AuthRepository.googleSignIn()` âœ…

### 1.11 Logout âœ…
- **Endpoint**: `POST /auth/sign-out?refresh_token=<token>` âœ…
- **Implementation**: `AuthRepository.signOut()` âœ…

---

## âœ… User Profile APIs - Updated to Match Docs

### 2.1 Get User Profile âœ…
- **Endpoint**: `GET /users/{user_id}` âœ…
- **Requires**: Authorization âœ…
- **Implementation**: `AuthRepository.getCurrentUser()` âœ…
 
### 2.2 Update Username & Profile Image âœ…
- **Endpoint**: `PUT /users/{user_id}/profile` âœ…
- **Content-Type**: `multipart/form-data` âœ…
- **Requires**: Authorization âœ…
- **Fields**: username, profile_image âœ…
- **Implementation**: `AuthRepository.updateUserProfile()` âœ… (NEW METHOD)
- **Note**: Also kept `updateProfilePicture()` for backward compatibility

### 2.3 Update Password âœ…
- **Endpoint**: `PUT /users/{user_id}/password` âœ…
- **Requires**: Authorization âœ…
- **Body**: `{ "old_password": "...", "password": "...", "confirm_password": "..." }` âœ…
- **Implementation**: `AuthRepository.updatePassword()` âœ…
 
### 2.4 Delete Account âœ…
- **Endpoint**: `DELETE /users/{user_id}` âœ…
- **Requires**: Authorization âœ…
- **Implementation**: `AuthRepository.deleteAccount()` âœ…

---

## âœ… Wallpaper APIs - All Verified

### 3.1 AI Prompt Suggestion âœ…
- **Endpoint**: `POST /wallpapers/suggest`
- **Body**: `{ "prompt": "..." }` âœ…
- **Implementation**: `WallpaperRepository.suggestPrompt()` âœ…
- **Added**: Authorization support âœ…

### 3.2 Create Wallpaper âœ…
- **Endpoint**: `POST /wallpapers/`
- **Body**: `{ "prompt": "...", "size": "...", "style": "..." }` âœ…
- **Optional**: `title`, `ai_model` (kept for backward compatibility) âœ…
- **Implementation**: `WallpaperRepository.createWallpaper()` âœ…
- **Added**: Authorization support âœ…

### 3.3 Recreate Wallpaper âœ…
- **Endpoint**: `POST /wallpapers/{wallpaper_id}/recreate` âœ…
- **Implementation**: `WallpaperRepository.recreateWallpaper()` âœ…
- **Added**: Authorization support âœ…

### 3.4 List Wallpapers âœ…
- **Endpoint**: `GET /wallpapers/` âœ…
- **Implementation**: `WallpaperRepository.fetchWallpapers()` âœ…
- **Added**: Authorization support âœ…

### 3.5 Delete Wallpaper âœ…
- **Endpoint**: `DELETE /wallpapers/{wallpaper_id}` âœ…
- **Requires**: Authorization âœ…
- **Implementation**: `WallpaperRepository.deleteWallpaper()` âœ… (NEW METHOD)

### 3.6 Download Wallpaper âœ…
- **Endpoint**: `GET /wallpapers/{wallpaper_id}/download` âœ…
- **Response**: `Content-Type: image/jpeg | image/png` âœ…
- **Implementation**: `WallpaperRepository.downloadWallpaper()` âœ…
- **Returns**: `Uint8List` (raw image bytes) âœ…
- **Added**: `ApiService.getRaw()` method for binary responses âœ…

---

## ğŸ”§ Key Fixes Applied

 2. âœ… **Update Profile**: Added `updateUserProfile()` method for multipart/form-data with username and profile_image
3. âœ… **Download Wallpaper**: Fixed to handle binary image response instead of JSON
4. âœ… **Delete Wallpaper**: Added missing endpoint
5. âœ… **Authorization**: Added authorization headers to all wallpaper endpoints
6. âœ… **Create Wallpaper**: Made `title` and `ai_model` optional to match API docs exactly
7. âœ… **Verify Email**: Updated to only require `code` (removed email requirement)
8. âœ… **Error Handling**: All endpoints properly handle `msg`, `message`, `error` fields

---

## ğŸ“ Notes

 - Authorization tokens are optional parameters in repository methods for flexibility
- Error responses properly extract messages from `msg`, `message`, or `error` fields
- All Provider view models are registered and ready to use

---

## âœ… Status: All APIs Verified and Integrated

All endpoints match the API documentation. The codebase is ready for production use.

